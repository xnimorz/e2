!function(t){"use strict";function e(){}function n(t,e,n){n[t]||(n[t]=[]),n[t].push(e)}function i(t,e,n,i){e[t]&&e[t].forEach(function(t){t.call(i,n)})}function o(t,e){var n=e.indexOf(t);n!==-1&&e.splice(n,1)}function r(t,e,n){t[e]&&(n?o(n,t[e]):t[e]=[])}var s=function(){var e=[],n=function(t){return e.push(t)-1},i=function(){var t=e,n=t.length,i=0;for(e=[];i<n;)t[i++]()};if("function"==typeof setImmediate)return function(t){n(t)||setImmediate(i)};if("object"==typeof process&&process.nextTick)return function(t){n(t)||process.nextTick(i)};if(t.postMessage){var o=!0,r=t.onmessage;if(t.onmessage=function(){o=!1},t.postMessage("","*"),t.onmessage=r,o){var s="__e2__"+(new Date).getTime(),c=function(t){t.data===s&&(t.stopPropagation&&t.stopPropagation(),i())};return t.addEventListener?t.addEventListener("message",c,!0):t.attachEvent("onmessage",c),function(e){n(e)||t.postMessage(s,"*")}}}return function(t){n(t)||setTimeout(i,0)}}();e.prototype.on=function(t,e,i){this.__e2__||(this.__e2__={callbacksOnce:{},callbacks:{}});var o=this.__e2__;if(t&&Array.isArray(t))return t.forEach(function(t){this.on(t,e,i)},this),this;if(t&&"object"==typeof t)return i=e,Object.keys(t).forEach(function(e){this.on(e,t[e],i)},this),this;if("string"!=typeof t)throw new TypeError("e2.on: Invalid event type");return i&&i.once?n(t,e,o.callbacksOnce):n(t,e,o.callbacks),this},e.prototype.once=function(t,e){return this.on(t,e,{once:!0})},e.prototype.off=function(t,e){if(!this.__e2__)return this;if(t&&Array.isArray(t))return t.forEach(function(t){this.off(t,e)},this),this;if(t&&"object"==typeof t)return Object.keys(t).forEach(function(e){this.off(e,t[e])},this),this;if(!t||"string"!=typeof t)throw new TypeError("e2.off: Invalid event type");var n=this.__e2__;return r(n.callbacks,t,e),r(n.callbacksOnce,t,e),this},e.prototype.listeners=function(t){if(!t||"string"!=typeof t)throw new TypeError("e2.listeners: Invalid event type");return this.__e2__?[].concat(this.__e2__.callbacks[t]||[]).concat(this.__e2__.callbacksOnce[t]||[]).slice(0):[]},e.prototype.emit=function(t,e,n){if(!this.__e2__)return this;if(t&&Array.isArray(t))return void t.forEach(function(t){this.emit(t,e,n)},this);if("string"!=typeof t)throw new TypeError("e2.emit: Invalid event type");var o={type:t,target:this};e&&(o.data=e);var c=this.__e2__,a=this,f=function(){i(t,c.callbacks,o,a),i(t,c.callbacksOnce,o,a),r(c.callbacksOnce,t)};return n?s(f):f(),this},e.prototype.emitAsync=function(t,e){return this.emit(t,e,!0)},function(e){"object"==typeof exports?module.exports=e:"function"==typeof define&&define.amd?define(e):t.E2=e}(e)}(this);